# 0914 정리

### FBP(Flow-Based Programming)

![캡처](https://user-images.githubusercontent.com/87689191/190146330-ab53eccb-497a-4397-91d8-4824eb501f7a.PNG)

- **MQTT Blocker**
    - 외부 시스템과 연동을 위해 메시지 중계 역할을 수행한다.
    - Mosquitto Blocker 사용
    - 공개소프트웨어
- **FBP**
    - 구현(개발) 할 목표
- **InfluxDB**
    - 타임시리즈 데이터베이스
    - 공개 소프트웨어
- **Grafana**
    - 애널리틱스 및 인터랙티브 시각화 웹 어플리케이션
    - 공개 소프트웨어

---
### FBP란?
- 1970년대 초 J.Paul Morrison이 발명.
- [&#128083;](https://en.wikipedia.org/wiki/Flow-based_programming) 위키피디아 정보

중요한 점
- 프로세스 네트워크
- 메시지 전달을 통한 데이터 교환
- 프로세스간 무한 연결을 통해 어플리케이션 구성
- 구성 요소 지향적(Component-oriented)

---
### 기본 개념
FBP는 블랙 박스와 박스 간 연결로 정의될 수 있으며, 단순한 FBP는 다음 그림과 같다.
![캡처](https://user-images.githubusercontent.com/87689191/190150440-37eef4af-9250-4886-81bf-6adbe6b4153c.PNG)
표준 입력 프로세스에서는 외부 장치(키보드, 마우스)로부터 들어온 데이터를 메시지에 실어서 다음 프로세스인 표준 출력으로 전달한다. 전달된 데이터는 표준 출력 프로세스에서 처리되어 지정된 출력 장치로 출력하게 된다.

---

### FBP 구성 요소

<br/>

### 1. 메시지(Message)
처리해야할 데이터와 이와 관련된 부가 정보를 포함하고 있으며, Flow 전체를 흘러다니는 데이터 운송자를 말함
- 식별자
    - 메시지는 생성될때 마다 고유의 식별자를 갖는다.
- 생성 시각
    - 메시지를 생성한 시각(참고 정보)
- 데이터
    - 처리해야할 데이터로써 메시지를 생성하는 객체에 따라 달라 질 수 있다.

<br/>

### 2. 노드(Node)
FBP에서 데이터 가공 또는 가공을 위한 제어를 담당하는 것을 일반적으로 프로세스라고 할 수 있다. 이러한 프로세스를 노드라 부른다. 

<br/>

**노드 특징**
- 기능이 단순하고 명확해야 한다.
- 하나의 노드에서 모든 문제를 해결하기 보다는 다수의 노드 연결을 통해 문제를 해결할 수 있도록 한다.
- 다양한 문제에 재사용 가능하도록 한다.

<br/>

### 2.1 입력 노드(Input Node)
플로우 외부와의 연결을 담당하는 프로세스로서 시스템 자원으로부터 데이터를 가져오거나, 다른 플로우로부터 메시지를 받아 소속된 플로우에 데이터를 올려주는 역할을 수행한다.

<br/>

### 2.1.1 표준 입력 노드(StandardInNode)
표준 입력 노드는 앱의 표준 입력을 통해 입력되는 데이터를 설정되어 있는 출력 단위로 구분하고, 이를 메시지에 실어 플로우에서 처리 가능하도록 출력한다. 

<br/>

**설정**
- 설정가능한 출력 단위
    - 문자
    - 단어
    - 라인

<br/>

**메시지 정보**
- 데이터
- 정보
    - 입력 문자 수

<br/>

### 2.1.2 파일 입력 노드(FileInNode)
파일을 읽어 플로우에 실어주는 기능을 수행한다. 파일에서 읽은 데이터를 설정한 단위로 구분하고, 이를 메시지에 실어 플로우에서 처리 가능하도록 출력한다.

<br/>

**설정**
- 설정가능한 출력 단위
    - 데이터의 종류에 따른 분류
        - 바이너리 데이터
            - 바이트
            - 블록(사이즈 지정)
            - 전체
        - 텍스트 데이터
            - 문자
            - 단어
            - 라인
            - 전체
    - 파일 끝 알림

<br/>

**메시지 정보**
- 데이터
- 파일 정보
    - 파일 이름
    - 크기
    - 옵셉

<br/>

### 2.1.3 TCP 입력 노드(TCPInNode)
TCP 소켓을 통해 들어오는 데이터를 패킷 단위로 구분하여 메시지를 생성하고, 이를 플로우에서 처리 할 수 있도록 실어주는 기능을 수행한다.

<br/>

**설정**
- TCP 소켓 오브젝트 지정

<br/>

**메시지 정보**
- 데이터
- 상대 정보
    - IP 주소
    - 포트

<br/>

### 2.2 출력 노드(Output Node)
입력 노드와 마찬가지로 플로우 외부와의 연결을 담당하는 프로세스로서 플로우에서 가공 처리된 데이터를 외부 시스템 또는 다른 플로우로 전달하는 역할을 수행한다.

<br/>

### 2.2.1 표준 출력 노드(StandardOutNode)
표준 출력 노드는 입력 포트를 통해 들어오는 데이터를 정해진 표준 출력으로 내보낸다.

<br/>

**설정**
- 출력 단위
    - 입력 데이터
    - 시간 간격

<br/>

### 2.2.2 파일 출력 노드(FileOutNode)
파일 출력 노드는 입력 포트를 통해 들어오는 데이터를 지정되어 있는 파일로 출력한다.

<br/>

**설정**
- 파일 이름
    - 데이터 저장 파일
- 저장 모드
    - 새로 생성
    - 추가

<br/>

**메시지 정보**
- 데이터
- 파일 정보
    - 신규 생성
    - 추가

<br/>

### 2.2.3 MQTT Publish 노드(MQTTPublishNode)
MQTT Publish 노드는 입력 포트를 통해 들어오는 데이터를 지정된 클라이언트를 통해 브로커로 전송한다.

1. 노드가 직접 외부 브로커에 연결되지는 않고, 별도로 생성되고 관리되는 클라이언트 중에서 선택하여 연결된다.
1. 노드는 하나의 클라이언트에만 연결된다.
1. 기본 정보로 토픽, 우선 순위 등이 설정 가능하나, 메시지에 해당 정보가 실려 올 경우 이를 우선적으로 적용한다.

![캡처](https://user-images.githubusercontent.com/87689191/190161379-55d84b8e-9d33-4198-b19e-55f32f0901f4.PNG) 

<br/>

**설정**
- 대상 클라이언트
- 토픽
- 우선 순위

<br/>

**메시지 정보**
- 데이터
- 토픽(추가 정보)
- 우선 순위(추가 정보)

<br/>

### 2.2.4 InfluxDB 노드(InfluxDBNode)
InfluxDB에 접속하여 데이터를 저장한다. (Line Protocol 이용)

<br/>

**설정**
- 데이터 베이스 접속 정보
    - IP 정보
    - 포트
    - 인증 정보

<br/>

**메시지 정보**
- 데이터

<br/>

### 2.3 입출력 노드(Input Output Node)
입출력 노드는 입력 메시지를 통해 데이터를 받아 가공 후 출력 메시지를 통해 다른 노드로 전달하는 노드이다. 플로우 구성에 있어 가장 많이 사용되며 실질적인 프로그램 구성 노드이다.

<br/>

### 2.3.1 스크립트 함수 노드(ScriptFuntionNode)
스크립트 함수 노드는 입력 포트를 통해 들어온 데이터를 가공하고, 이를 다시 출력 포트로 내보낸다. 입력 메시지는 JavaScript의 오브젝트 형태로 변환되고, 이를 설정한 스크립트에서 처리한 후 자바 오브젝트로 변환하여 출력한다.

<br/>

**설정**
- JavaScript

<br/>

**입력 메시지 정보**
- JSON 오브젝트 형식 데이터

<br/>

**출력 메시지 정보**
- JSON 오브젝트 형식 데이터

<br/>

### 2.3.2 객체에서 JSON으로 변환 노드(ObjectToJSONNode)
자바 객체로 입력되는 데이터를 JSON 형태로 변환해서 출력 포트로 내보낸다.

<br/>

**입력 메시지 정보**
- 자바 오브젝트 형식 데이터

<br/>

**출력 메시지 정보**
- JSON 오브젝트 형식 데이터

<br/>

### 2.3.3 JSON에서 객체로 변환 노드(JSONToObjectNode)
JSON형태의 데이터를 자바 객체로 변환해서 출력 포트로 내보낸다.

<br/>

**입력 메시지 정보**
- JSON 오브젝트 형식 데이터

<br/>

**출력 메시지 정보**
- 자바 오브젝트 형식 데이터

<br/>

### 2.3.4 필터 노드(FilterNode)
필터 노드는 입력된 메시지의 데이터나 기타 정보를 이용해 해당 메시지의 출력 여부를 결정한다.

<br/>

**설정**
- 필터 조건

<br/>

**메시지 정보**
- 데이터

<br/>

### 2.3.5 지연 노드(DelayNode)
지연 노드는 입력된 메시지를 설정 시간만큼 지연 후 출력한다. 입력 메시지에 추가정보로 지연 시간이 있는 경우, 지연 시간을 적용한다.

<br/>

**설정**
- 기본 지연 시간

<br/>

**입력 메시지 정보**
- 데이터
- 지연 시간(추가정보)

<br/>

**출력 메시지 정보**
- 데이터

<br/>

### 2.3.6 잠금 노드(LockNode)
잠금 노드는 해당 노드부터 잠금 해제 노드까지의 경로에 하나의 패킷만 존재해야할 경우 적용 가능하다.  
잠금 노드를 적용한 경우, 어떠한 경로를 통하더라도 잠금 해제 노드를 통할 수 있도록 설계되어야 하며, 그렇지 못한 경우 정상적인 수행이 불가능할 수도 있다.  
잠금 노드는 별도로 생성되어 관리되는 잠금 객체와 연결되고, 해당 객체를 통해 잠금을 수행한다.

<br/>

**설정**
- 잠금 객체
- 잠금 대기 시간
    - 초단위를 기준으로 소수형
    - 0으로 설정할 경우, 무한 대기

<br/>

**입력 메시지 정보**
- 데이터
- 잠금 대기 시간(추가 정보)

<br/>

**출력 메시지 정보**
- 데이터
- 잠금 객체

<br/>

### 2.3.7 잠금 해제 노드(UnlockNode)
잠금 해제 노드는 잠금 노드를 지나며 설정된 구간 잠금을 해제하는 노드이다.  
잠금 해제 노드는 별도로 생성되어 관리되는 잠금 객체와 연결하고, 해당 객체를 통해 잠금 해제를 수행한다.

**설정**
- 잠금 객체

<br/>

**입력 메시지 정보**
- 데이터
- 잠금 객체

<br/>

**출력 메시지 정보**
- 데이터

<br/>

### 2.3.8 TCP 출력 노드(TCPOutNode)
TCP 출력 노드는 입력 포트를 통해 들어오는 데이터를 지정된 TCP 소켓 오브젝트를 이용해 데이터를 전송한다.

**설정**
- 대상 소켓 오브젝트
- 연결 모드
    - 자동 재연결

<br/>

**입력 메시지 정보**
- 데이터

<br/>

**출력 메시지 정보(출력 연결이 있는 경우)**
- 전송 결과

<br/>


### 2.4 지원 노드(Agent Node)

<br/>

### 2.4.1 TCP 클라이언트 노드(TCPClientNode)
TCp 소켓 접속을 지원하고, 관련된 자원을 관리한다.  
플로우 상에 직접적으로 존재하는 것이 아니며, 플로우에 참여하는 TCPInNode와 TCPOutNode를 지원하는 역할이다.

<br/>

**설정**
- 접속 호스트 IP주소
- 서비스 포트

<br/>

### 2.4.2 TCP 서버 노드(TCPServerNode)
TCP 소켓을 열고, 클라이언트가 접속하길 대기 하고, 해당 접속에 대한 세션을 생성하고 관리한다.  
플로우 상에 직접적으로 존재하는 것인 아니며, 플로우에 참여하는 TCPInNode와 TCPOutNode를 지원하는 역할 을 수행한다.

<br/>

**설정**
- 서비스 포트

<br/>

### 2.4.3 인터페이스
노드 관리를 위한 공통된 메서드를 지원한다.

<br/>

### 2.4.4 TCP 지원자(TCPAgentNode)
TCPClientNode와 TCPServerNode는 플로우 상에 존재하지 않고, TCPInNode와 TCPOutNode를 지원하는 역할을 수행한 다. 두 노드는 클라이언트나 서버를 선택하여 사용할 수 있어 공통적인 접속 방법이 필요하다.  
TCPAgentNode는 TCPClientNode와 TCPServerNode 에서 지원하는 공통 메소드로 구성되어 있으며, TCPInNode와 TCPOutNode 에서 해당 인터페이스를 통해서 TCP 지원자들을 이용한다.

<br/>

### 3. 와이어(Wire)
와이어는 플로우 상에서 노드간 연결을 나타낸다. 와이어의 한 쪽은 노드의 출력포트에 연결, 나머지 한 쪽은 노드의 입력포트에 연결되어야 한다.

<p align="center"><img width="397" alt="스크린샷 2022-09-14 오후 10 41 54" src="https://user-images.githubusercontent.com/87689191/190170489-9b952858-e294-487d-8e67-27aa215eedd7.png"></p>

3개의 노드가 2개의 와이어로 연결된 그림  
<br/>
와이어는 의미적으로 화살표와 같이 표시될 수 있으며, 화살표의 시작 위치는 노드의 출력 포트에 연결되어 전송될 메시지를 받는 부분을 표시하고 화살표의 끝 위치는 노드의 입력 포트에 연결되어 전송된 메시지를 내보내는 부분을 표시한 것이다.

<br/>

### 4. 플로우(Flow)
플로우는 우리가 일반적으로 알고 있는 프로그램 또는 기능을 수행하는 모듈과 같다. 입력된 데이터가 결과로 나오는 과정을 데이터의 흐름으로 표현한 것이다.

<p align ="center"> <img width="868" alt="스크린샷 2022-09-14 오후 10 49 26" src="https://user-images.githubusercontent.com/87689191/190172307-e2c32050-6d76-44e3-94fa-42d7b7ea6a0b.png">
</p>
예시 그림



---



# 1024 ì •ë¦¬

### Web/Servlet

<br/>

**ì›¹ì„œë²„**
- http í”„ë¡œí† ì½œì„ í†µí•´ ì›¹ ë¸Œë¼ìš°ì €ì— ìš”ì²­
- html, ì´ë¯¸ì§€, JavaScript íŒŒì¼ ë“±ì„ ì „ì†¡í•´ì£¼ëŠ” ì„œë¹„ìŠ¤ í”„ë¡œê·¸ë¨
- ì¢…ë¥˜
    - apache httpd
    - nginx

<br/>

**ì •ì  ì›¹ ì»¨í…ì¸ **
- ì›¹ ì„œë²„ì— ë¯¸ë¦¬ ì €ì¥ë˜ì–´ ìˆëŠ” ì»¨í…ì¸ 
- ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ë™ì¼í•œ ë‚´ìš©ì´ ì „ë‹¬
- html, ì´ë¯¸ì§€ ë“±

<br/>

**ë™ì  ì›¹ ì»¨í…ì¸ **
- ì‚¬ìš©ìì— íŠ¹ì •í•œ ìš”ì¸ì´ë‚˜ ìš”ì²­ì— ë”°ë¼ ë³€ê²½ë˜ëŠ” ì»¨í…ì¸ 
- ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ë™ì¼í•˜ê²Œ í‘œì‹œë˜ì§€ ì•Šìœ¼ë©° ì‚¬ìš©ìì™€ì˜ ìƒí˜¸ì‘ìš©ì— ë‹¤ë¼ ë³€ê²½ë  ìˆ˜ ìˆë‹¤.

<br/>

**CGI**
- Common Gateway Interface
- ì›¹ ì„œë²„ê°€ **ì™¸ë¶€ í”„ë¡œê·¸ë¨**ì„ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ì¸í„°í˜ì´ìŠ¤ ëª…ì„¸
    - ì›¹ ì„œë²„ëŠ” ë™ì  ì²˜ë¦¬ë¥¼ ëª»í•¨
    - CGIê°€ í•´ê²°
    - ì™¸ë¶€ í”„ë¡œê·¸ë¨ : ë™ì  ì›¹ ì»¨í…ì¸ ë¥¼ ìƒì„±í•˜ëŠ” ì—­í• 
    - í™˜ê²½ ë³€ìˆ˜ë‚˜ í‘œì¤€ì…ì¶œë ¥ì„ ë‹¤ë£° ìˆ˜ ìˆëŠ” í”„ë¡œê·¸ë¨ ì–¸ì–´ë©´ ì–´ë–¤ ì–¸ì–´ë“  í™•ì¥ í•˜ì—¬ ì´ìš© ê°€ëŠ¥

<img width="526" alt="image" src="https://user-images.githubusercontent.com/87689191/200176122-5b8fed2d-960b-4098-b317-f3fad26e5044.png">


<br/>

**Java CGI ë¬¸ì œì **
1. ë³„ë„ì˜ ìŠ¤í¬ë¦½íŠ¸ê°€ í•„ìš”
1. í™˜ê²½ë³€ìˆ˜ë¥¼ ëª…ì‹œì ìœ¼ë¡œ Java í”„ë¡œê·¸ë¨ì— ë„˜ê²¨ì¤˜ì•¼ í•¨

<br/>

**CGIì˜ ë¬¸ì œì **
- ë§¤ http ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ê°€ ìƒì„±
- ì†ë„ê°€ ëŠë¦¬ê³  ì„œë²„ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì‚¬ìš©

<br/>

ë²ˆì™¸
- ì›¹ì–´í”Œë¦¬ì¼€ì´ì…˜ : `war` (Web Application ARchive)
- ìŠ¤í”„ë§ ë¶€íŠ¸ : `jar` (Java ARchive)
- tar : Unix/Linux archive utility

---

### Servlet

<br/>

**Intellijì—ì„œ Servlet í”„ë¡œì íŠ¸**
- Add Framework Support
    - Web Application ì¶”ê°€
- `web`ë””ë ‰í† ë¦¬ë¥¼ `webapp`ìœ¼ë¡œ ì´ë¦„ ë³€ê²½
    - `src/main`ìœ¼ë¡œ ì´ë™
- `pom.xml` ì˜ì¡´ì„± ì¶”ê°€ & packaging ì„¤ì •
    <details>
        <summary> pom.xml </summary>

    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <project xmlns="http://maven.apache.org/POM/4.0.0"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
        <modelVersion>4.0.0</modelVersion>

        <groupId>com.nhnacademy</groupId>
        <artifactId>servlet-day1</artifactId>
        <version>1.0-SNAPSHOT</version>
        <packaging>war</packaging>

        <properties>
            <maven.compiler.source>11</maven.compiler.source>
            <maven.compiler.target>11</maven.compiler.target>
            <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        </properties>

        <dependencies>
            <dependency>
                <groupId>jakarta.servlet</groupId>
                <artifactId>jakarta.servlet-api</artifactId>
                <version>4.0.4</version>
                <scope>provided</scope>
            </dependency>

            <dependency>
                <groupId>org.projectlombok</groupId>
                <artifactId>lombok</artifactId>
                <version>1.18.24</version>
            </dependency>

            <dependency>
                <groupId>ch.qos.logback</groupId>
                <artifactId>logback-classic</artifactId>
                <version>1.2.11</version>
            </dependency>
        </dependencies>

        <build>
            <plugins>
                <plugin>
                    <groupId>org.apache.maven.plugins</groupId>
                    <artifactId>maven-war-plugin</artifactId>
                    <version>3.3.2</version>
                </plugin>
            </plugins>
        </build>

    </project>
    ```

    </details>
    

- Run Configuration (ì‹¤í–‰ êµ¬ì„±í¸ì§‘)
    - í†°ìº£ ë¡œì»¬ ì¶”ê°€
    - ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ : í†°ìº£ ì„¤ì¹˜ ê²½ë¡œ ì§€ì •
    - ë°°í¬ : war exploded
        - ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ : `/`ë§Œ ë‚¨ê¸°ê¸°

<br/>

**Servlet ì •ì˜**
- Javaë¥¼ ì‚¬ìš©í•´ì„œ ë™ì  ì›¹ ì»¨í…ì¸ ë¥¼ ìƒì„±í•˜ëŠ” ì„œë²„ì¸¡ í”„ë¡œê·¸ë¨
- ì‰½ê²Œ Javaë¡œ CGI í”„ë¡œê·¸ë¨ì„ ë§Œë“œëŠ” ê²ƒ
    - ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆë¡œìš´ í”„ë¡œì„¸ìŠ¤ê°€ ìƒì„±ë˜ëŠ” ë¬¸ì œ -> ë©€í‹° ìŠ¤ë ˆë“œë¡œ í•´ê²°
    - ìŠ¤ë ˆë“œ ìƒì„±ê³¼ ê´€ë¦¬ -> ì»¨í…Œì´ë„ˆë¡œ í•´ê²°

<br/>

**Servelet Architecture**

<img width="744" alt="image" src="https://user-images.githubusercontent.com/87689191/200178280-7d4469ff-3dbe-4b30-943d-92b4d759675d.png">


---

### ìš©ì–´ ì •ë¦¬

<br/>

**Java EE**
- Javaì–¸ì–´ì˜ `í”Œë«í¼` ì¤‘ í•˜ë‚˜
    - Javaì–¸ì–´ë¡œ ì‘ì„±ëœ í”„ë¡œê·¸ë¨ì´ ì‹¤í–‰ë˜ëŠ” íŠ¹ì •í•œ í™˜ê²½
    - íŠ¹ì • í™˜ê²½ë³„ë¡œ ë‚˜ëˆ„ì–´ì§ (ë²”ìœ„ë¥¼ ê¸°ì¤€)
        - ê°œì¸, ê¸°ì—… ë“±ë“±

<br/>

**Java ì–¸ì–´ í”Œë«í¼ ì¢…ë¥˜**
- Java SE
    - Standard Edition
    - ì¼ë°˜ì ì¸ ì‘ìš© í”„ë¡œê·¸ë¨ ê°œë°œ ìš©ë„
- Java EE
    - Enterprise Edition
    - SEë¥¼ í™•ì¥í•˜ì—¬ ë¶„ì‚° ì»´í“¨íŒ…, ì›¹ ì„œë¹„ìŠ¤ì™€ ê°™ì€ ì—”í„°í”„ë¼ì´ì¦ˆ í™˜ê²½ ì§€ì›
- Java ME
    - ì„ë² ë””ë“œ ì‹œìŠ¤í…œì´ë‚˜ ëª¨ë°”ì¼ ë””ë°”ì´ìŠ¤ë¥¼ ìœ„í•œ ê°œë°œ í™˜ê²½ ì§€ì›
- Java Fx
    - ë°ìŠ¤í¬í†± ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œ í™˜ê²½ ì§€ì›
- Jakarta EE
    - ì˜¤ë¼í´ -> Eclipse ìœ¼ë¡œ ìš´ì˜ì´ ë„˜ì–´ê°€ë©´ì„œ ì´ë¦„ë„ ë³€ê²½

<br/>

**WAS**
- Web Application Server
- ì •ì  ì›¹ ì»¨í…ì¸ ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì›¹ì„œë²„ì™€ êµ¬ë¶„í•˜ê¸° ìœ„í•œ ìš©ë„
- Servlet Container ì—­í•  ìˆ˜í–‰
- ë™ì  ì›¹ ì»¨í…ì¸ ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ ì„œë²„ í™˜ê²½ì„ ë§Œë“¤ì–´ ë™ì‘ì‹œí‚¤ëŠ” ê¸°ëŠ¥ ì œê³µ
- Servletë§Œ í•œì •í•´ì„œë³´ë©´
    - WAS == Servlet Container
- tomcat : ë¬´ë£Œ ì˜¤í”ˆ ì†ŒìŠ¤ WAS
- Servlet specê³¼ tomcat versionì—” ìµœì†Œ ì§€ì› ë²„ì „ì´ ìˆìŒ

<br/>

**ì •ë¦¬**
- Servlet
    - ë™ì  ì›¹ ì»¨í…ì¸ ë¥¼ ìƒì„±í•˜ëŠ” ì„œë²„ ì¸¡ í”„ë¡œê·¸ë¨
    - CGI ë‹¨ì  í•´ê²°
- Servlet Container
    - Servlet ìƒëª…ì£¼ê¸° ê´€ë¦¬
    - URL ìš”ì²­ ì²˜ë¦¬

<br/>

**ì›¹ ì„œë²„ì™€ WAS ì—°ë™**
- Proxy
    - ìì›ì„ ìš”ì²­í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ìì›ì„ ì œê³µí•˜ëŠ” ì„œë²„ ì‚¬ì´ì—ì„œì˜ ì¤‘ì¬ì ì—­í• ì„ í•˜ëŠ” ì„œë²„ í”„ë¡œê·¸ë¨
- Forward Proxy
    - ì‚¬ìš©ìì˜ ìš”ì²­ì„ ì‹¤ì œ ì„œë²„ê°€ ì§ì ‘ ë°›ì§€ ì•ŠìŒ
        - ì¤‘ê°„ì—ì„œ í¬ì›Œë“œ í”„ë¡ì‹œ ì„œë²„ê°€ ëŒ€ì‹  ìš”ì²­ì„ ë°›ì•„ ì‹¤ì œ ì„œë²„ì™€ ì—°ê²°í•˜ì—¬ ê·¸ ê²°ê³¼ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ì „ë‹¬
    - cachingì„ í†µí•´ ì„±ëŠ¥ í–¥ìƒ
    - ë³´ì•ˆ ê°•í™”
    - ì œí•œëœ ì¥ì†Œì—ì„œ ì‚¬ìš© (í•™êµ, ê´€ê³µì„œ)
    <img width="498" alt="image" src="https://user-images.githubusercontent.com/87689191/200179223-d7b73f77-51b3-426a-b0c6-04b3af11e72c.png">

- Reverse Proxy
    - ë³´ì•ˆ ìƒì˜ ì´ìœ ë¡œ DMZ ì¡´ì— ì›¹ ì„œë²„ë¥¼ ë‘ê³  WASëŠ” ë‚´ë¶€ë§ì— ìœ„ì¹˜
    - ìƒí™©ì— ë§ê²Œ ì›¹ ì„œë²„ì™€ WASë¥¼ ìœ ì—°í•˜ê²Œ ëŠ˜ë¦´ ìˆ˜ ìˆìŒ
    - ë‚´ë¶€ë§ì„ ì§€í‚¤ê³  ì™¸ë¶€ë§ì—ì„œ ì§ì ‘ ì˜¤ì§€ ì•Šë„ë¡ ì§€í‚´
    <img width="455" alt="image" src="https://user-images.githubusercontent.com/87689191/200179314-1bf54bd7-9321-4477-b521-e1d6b5a0e7da.png">

----

### Servlet

<br/>

**Servlet Interface**
```java
public interface Servlet {
    public void init(ServletConfig config) throws ServletException;

    public void service(ServletRequest req, ServletResponse res)
      throws ServletException, IOException;

    public void destroy();

    public ServletConfig getServletConfig();

    public String getServletInfo();
}
```

<br/>

**Servlet Life Cycle**

<img width="629" alt="image" src="https://user-images.githubusercontent.com/87689191/200576786-ba17f889-bfff-4dfb-9a81-08350451b543.png">

<br/>

**ì‹¤ìŠµ**
```java
@Slf4j
public class TestServlet extends HttpServlet {

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String title = getServletConfig().getInitParameter("title");
        String name = getServletConfig().getInitParameter("name");

        resp.getWriter().println("hello " + title + name);

        resp.getWriter().println(req.getRequestURI());
        resp.getWriter().println(req.getRequestURL());
    }

    @Override
    public void init(ServletConfig config) throws ServletException {
        log.info("init() called");
        super.init(config);
    }

    @Override
    protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        log.info("service() called");
        super.service(req, resp);
    }

    @Override
    public void destroy() {
        log.info("destroy() called");
        super.destroy();
    }
}
```

- `webapp/WEB-INF/web.xml`ì— ì €ì¥
- `localhost:8080/test`ê²½ë¡œë¡œ ì ‘ê·¼ ì„¤ì •
```xml
<servlet>
    <servlet-name>testServlet</servlet-name>
    <servlet-class>com.nhnacademy.servlet.TestServlet</servlet-class>
    <init-param>
        <param-name>title</param-name>
        <param-value>Mr.</param-value>
    </init-param>
    <init-param>
        <param-name>name</param-name>
        <param-value>GS.</param-value>
    </init-param>
</servlet>

<servlet-mapping>
    <servlet-name>testServlet</servlet-name>
    <url-pattern>/test</url-pattern>
</servlet-mapping>
```

<br/>

**Servlet Context**
- Servlet Container ì‹¤í–‰ í™˜ê²½
- Servlet ê³¼ Servlet Container ê°„ì— ì—°ë™ì„ ìœ„í•´ ì‚¬ìš©
- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ë§ˆë‹¤ í•˜ë‚˜ì˜ ServletContext ìƒì„±
- í•˜ë‚˜ì˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì— í¬í•¨ëœ Servlet ë“¤ì€ ë™ì¼í•œ ServletContext ê³µìœ 
- Servlet ë¼ë¦¬ ìì›ì„ ê³µìœ í•˜ëŠ”ë° í™œìš©
- Servlet Container ì‹¤í–‰ ì‹œ ìƒì„±ë˜ê³  Servlet Container ì¢…ë£Œ ì‹œ ì†Œë©¸
- ê¸°ëŠ¥
    - í™˜ê²½ ì •ë³´ ì œê³µ (context path, servlet version, real path ë“±)
    - ì„¤ì • ì •ë³´ ì œê³µ (init param, attribute ë“±)
    - Servlet / Filter / Listener ë“±ë¡
    - Servlet ì—ì„œì˜ íŒŒì¼ ì ‘ê·¼

- `web.xml`
```xml
<context-param>
    <param-name>url</param-name>
    <param-value>https://nhnacademy.com/</param-value>
</context-param>
```
- servlet
```java
getServletContext().getInitParameter("url")
```

<br/>

---

### web.xml

<br/>

**ë°°ì¹˜ ê¸°ìˆ ì„œ**
- ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ë°°ì¹˜ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” XML íŒŒì¼
- `/WEB-INF/` í•˜ìœ„ì— ìœ„ì¹˜

<br/>

**í•˜ìœ„ íƒœê·¸**
- servlet-name : Servlet ì´ë¦„
- servlet-class : Servlet class FQCN
- init-param : ì´ˆê¸° íŒŒë¼ë¯¸í„°
    - param-name
    - param-value
- load-on-startup : ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™ ì‹œ ë¡œë”© ì—¬ë¶€
- url-pattern : url ì ‘ê·¼ ì£¼ì†Œ
- context-param : ServletContextì˜ ì´ˆê¸° íŒŒë¼ë¯¸í„°
    - param-name
    - param-value
- welcome-file : `index.html`ê³¼ ê°™ì€ ê¸°ë³¸ í˜ì´ì§€
- error-page : ì—ëŸ¬ì‹œ ì²˜ë¦¬í•  í˜ì´ì§€
    - location : ì˜ˆì™¸ ì²˜ë¦¬í•  url -> *`/`ë¡œ ì‹œì‘í•´ì•¼ í•¨*
- filter : Servlet Filter ë“±ë¡ ì •ë³´
- filter-mapping : Servlet Filterì™€ url ì •ë³´
- listener : Linstener ë“±ë¡ ì •ë³´

<Br/>

---

### ê³¼ì œ

**NHN ë§ˆíŠ¸, Servlet versiontìœ¼ë¡œ êµ¬í˜„**
 - ì‹í’ˆë§¤ëŒ€
    - ì–‘íŒŒ(1,000ì›) 2ê°œ
    - ê³„ë€(2,000ì›) 5íŒ
    - íŒŒ(500ì›) 10ê°œ
    - ì‚¬ê³¼(2,000ì›) 20ê°œ
- Servlet
    - `GET /init`: ì‹í’ˆë§¤ëŒ€ ì¤€ë¹„
        - `context-param`ì— ì„¤ì •ëœ ì‹í’ˆ ì •ë³´ë¥¼ ì½ì–´ì„œ ì‹í’ˆ ê°ì²´ë¥¼ ìƒì„±
        - ServletContext Attributeë¡œ ì„¤ì •í•´ì„œ ëª¨ë“  Servletì—ì„œ ì°¸ì¡° ê°€ëŠ¥
        - ì‘ë‹µí™”ë©´ì— ìƒí’ˆ ëª©ë¡ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ë§í¬ ì œê³µ
    - `GET /foods`: ìƒí’ˆ ëª©ë¡
        - ì‘ë‹µì— ìƒí’ˆ ëª©ë¡ ì¶œë ¥
        - ì›í•˜ëŠ” ìƒí’ˆì„ ì„ íƒí•´ì„œ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì„ ìˆ˜ ìˆëŠ” form êµ¬ì„±
    - `POST /cart`: ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°
        - ìƒí’ˆ ìˆ˜ëŸ‰ë³´ë‹¤ ë” ë§ì€ ì£¼ë¬¸ì„ í•˜ì§€ ì•Šì•˜ëŠ”ì§€ ê²€ì¦
        - ì¥ë°”êµ¬ë‹ˆì— ë‹´ì€ ìˆ˜ëŸ‰ë§Œí¼ ìƒí’ˆë§¤ëŒ€ì—ì„œ ì œê±° ì²˜ë¦¬
        - ì‘ë‹µ í™”ë©´ì— ì¥ë°”êµ¬ë‹ˆ í™”ë©´ìœ¼ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ë§í¬ ì œê³µ
    - `GET /cart`: ì¥ë°”êµ¬ë‹ˆ í™”ë©´
        - ì‘ë‹µì— ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ìƒí’ˆ ëª©ë¡ê³¼ ì „ì²´ ê¸ˆì•¡ í‘œì‹œ
    - ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
        - `/loginForm.html`
        - `GET /login`
        - `POST /login`
        - `GET /logout`
    - `web.xml`
        - `welcome-file-list`ì— `index.html` ì¶”ê°€

<br/>

**ì½”ë“œ**
- ê³¼ì œ ì½”ë“œ : [ë§í¬ ğŸ”‘](https://github.com/unhas01/nhnacademy/tree/master/Week9/servlet-nhnmart)


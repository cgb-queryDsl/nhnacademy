# 1011 ì •ë¦¬

Spring Framework Coreì— ëŒ€í•´ ë°°ìš°ëŠ” ì²« ë‚ .

---

### Spring Framework

<br/>

**íŠ¹ì§•**
- ê²½ëŸ‰ ì»¨í…Œì´ë„ˆ, Spring Beanì„ ì§ì  ê´€ë¦¬
- POJOê¸°ë°˜ì˜ í”„ë ˆì„ì›Œí¬
    - POJO(Plain Old Java Object) : ì œ 3ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜ ì¸í„°í˜ì´ìŠ¤ ìƒì†ì„ ë°›ì§€ ì•ŠëŠ” Javaì˜ ê¸°ë³¸ ê¸°ëŠ¥ì„ ê°€ì§„ ê°ì²´
- ì œì–´ ì—­ì „(IoC)
- ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°(AOP) ì§€ì›
    - ë¹„ê¸°ëŠ¥ì  ìš”êµ¬ì‚¬í•­ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ê¸°ëŠ¥
- ì˜ì†ì„±ê³¼ ê´€ë ¨ëœ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ ì§€ì›

---
### Spring Framework Dependencies-1

<br/>

**pom.xml**

```xml
<dependencies>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.3.17</version>
    </dependency>
</dependencies>
```

--- 

### Spring Framework Dependencies-2

<br/>

**pom.xml**

```xml
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-framework-bom</artifactId>
            <version>5.3.17</version>
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>

<dependencies>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
    </dependency>
</dependencies>
```

- `spring-framework-bom`ì—ì„œ `version`ì„ 5.3.17ìœ¼ë¡œ ì§€ì •í–ˆê¸° ë•Œë¬¸ì— `spring-context`ë²„ì „ë„ 5.3.17ë¡œ ë§ì¶°ì¤Œ

---

### ë‹¤í˜•ì„±(Polymorphism)

<br/>

Javaì˜ ë‹¤í˜•ì„±
- ê°ì²´ëŠ” ë¶€ëª¨í´ë˜ìŠ¤ íƒ€ì…ì˜ ì°¸ì¡°ë³€ìˆ˜ë‚˜ êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ ë³€ìˆ˜ì— ë‹´ì„ ìˆ˜ ìˆë‹¤.
- ì°¸ì¡° ë³€ìˆ˜ì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ì‹¤ì œ êµ¬í˜„ ê°ì²´ì˜ ë©”ì„œë“œê°€ ì‹¤í–‰.
- ì¦‰, ë™ì¼í•œ ë©”ì‹œì§€ë¥¼ ì „ì†¡í•˜ì§€ë§Œ ì‹¤ì œë¡œ ì–´ë–¤ ë©”ì„œë“œê°€ ì‹¤í–‰ ë˜ëŠ”ì§€ëŠ” ê°ì²´ì˜ í´ë˜ìŠ¤ê°€ ë¬´ì—‡ì¸ê°€ì— ë”°ë¼ ê²°ì •

<br/>

**ì‹¤ìŠµ**

- MessageSender ì¸í„°í˜ì´ìŠ¤
```java
package com.nhnacademy.edu.springframework.messagesender.service;

import com.nhnacademy.edu.springframework.messagesender.User;

public interface MessageSender {

    void sendMessage(User user, String message);
}
```

- EmailMessageSender í´ë˜ìŠ¤
```java
package com.nhnacademy.edu.springframework.messagesender.service;

import com.nhnacademy.edu.springframework.messagesender.User;

public class EmailMessageSender implements MessageSender {

    public EmailMessageSender() {
        System.out.println("+ EmailMessageSender create");
    }

    public void init() {
        System.out.println("init method called in EmailMessageSender");
    }

    public void destroy() {
        System.out.println("- destroy EmailMessageSender");
    }

    @Override
    public void sendMessage(User user, String message) {
        System.out.println("Email Message Sent to "  + user.getPhoneNumber()
                + " : " + message);
    }
}
```

- SmsMessageSender í´ë˜ìŠ¤

```java
package com.nhnacademy.edu.springframework.messagesender.service;

import com.nhnacademy.edu.springframework.messagesender.User;

public class SmsMessageSender implements MessageSender{

    public SmsMessageSender() {
        System.out.println("+ SmsMessageSender create");
    }

    public void init() {
        System.out.println("init method called in SmsMessageSender");
    }

    public void destroy() {
        System.out.println("- destroy SmsMessageSender");
    }

    @Override
    public void sendMessage(User user, String message) {
        System.out.println("SMS Message Sent to "  + user.getPhoneNumber()
                + " : " + message);
    }
}
```

----

### Spring IoC

<br/>

**IoC**
- í”„ë¡œê·¸ë¨ì´ í˜ëŸ¬ê°€ëŠ” íë¦„ì´ë‚˜ ê°ì²´ì˜ ìƒì„±ì— ëŒ€í•œ ì œì–´ê¶Œì„ í”„ë ˆì„ì›Œí¬ê°€ ê°€ì§€ëŠ” ê²ƒì„ ì˜ë¯¸
- ê°œë°œìê°€ ì½”ë“œì˜ íë¦„ì´ë‚˜ ê°ì²´ ìƒì„±ê³¼ ê´€ë ¨ëœ ì½”ë“œë¥¼ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³  í”„ë ˆì„ì›Œí¬ì— ì„¤ì •ì„ ì œê³µí•˜ë©´ í”„ë ˆì„ì›Œí¬ê°€ ì´ë¥¼ í† ëŒ€ë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì½”ë“œê°€ ë™ì‘í•˜ëŠ” ìˆœì„œë¥¼ ê²°ì •í•œë‹¤ëŠ” ì˜ë¯¸

<br/>

**ì˜ˆì‹œ ì½”ë“œ**
- í”„ë ˆì„ì›Œí¬ê°€ proceessìˆœì„œë¥¼ ì •í•´ë†¨ë‹¤ê³  ê°€ì •
```java
public abstract class AbstractProcessor {

    public final void process() {
        preProcess();
        mainProcess();
        postProcess();
    }

    protected abstract void preProcess();
    protected abstract void mainProcess();
    protected abstract void postProcess();
}
```

```java
public class ConsoleLogProcessor extends AbstractProcessor {

    @Override
    protected void preProcess() {
        System.out.println("preProcess");
    }

    @Override
    protected void mainProcess() {
        System.out.println("mainProcess");
    }

    @Override
    protected void postProcess() {
        System.out.println("postProcess");
    }
}
```

- êµ¬í˜„ì€ `preProcess()`, `mainProcess()`, `postProcess()`ì—ì„œ êµ¬í˜„í–ˆì§€ë§Œ ì‹¤í–‰ íë¦„ì€ í”„ë ˆì„ì›Œí¬ê°€ ì •í•´ë…¼ ìˆœì„œëŒ€ë¡œ ì§„í–‰í•  ìˆ˜ ë°–ì— ì—†ë‹¤.
- ì¼ì¢…ì˜ template method íŒ¨í„´

**íë¦„ì˜ ì œì–´ì—­ì „**
```java
public class TemplateMethodMain {

    public static void main(String[] args) {
        AbstractProcessor processor = new ConsoleLogProcessor();
        processor.process();
    }
}
```

<br/>

**ê°ì²´ ìƒì„±ì˜ ì œì–´ì—­ì „**
- KoreanGreeter ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì œì–´ë¥¼ ê°œë°œìê°€ ì§ì ‘ êµ¬í˜„
```java
public class NonIocMain {

    public static void main(String[] args) {
        new ComplexGreetingService().greet();
    }
}
```

```java
public class ComplexGreetingService {

    // ComplexGreetingService ë‚´ë¶€ì—ì„œ ìƒì„±í•œ ê°ì²´ë¥¼ ì‚¬ìš©í•œë‹¤.
    public boolean greet() {
        return new KoreanGreeter().sayHello();
    }
}
```

---
### ApplicationContext

<br/>

### Spring IoC Container

<br/>

**ì—­í• **
- Instantiaiting
- Configuring
- Assembling the beans

<br/>

### Spring Bean
- IoC Containerì—ì„œ ê´€ë¦¬

<br/>

**êµ¬ì„± ì¡°ê±´**
- name
- type
- object


<br/>

**Bean Factory vs ApplicationContext**

<img width="223" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-11 á„‹á…©á„’á…® 6 16 08" src="https://user-images.githubusercontent.com/87689191/195050227-7154cc9e-56c7-427a-9983-c7c23a0b35e7.png">

- ApplicationContext = Bean Factory ê¸°ëŠ¥ + Î±
- ë” ë§ì€ ê¸°ëŠ¥ì´ êµ¬í˜„ë˜ì–´ìˆê¸° ë•Œë¬¸ì— `ApplicationContext`ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤

<br/>

**ApplicationContext ì—­í• **
- Spring Bean ìƒì„±
- Spring Bean íŒŒê¸°
- Spring Bean ì£¼ì…

---

### Spring Framework ê°ì²´ ìƒì„± ì‹¤ìŠµ
- beans.xmlì— ì‘ì„±
- src/main/resourcesì— ìœ„ì¹˜

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean
        id="emailMessageSender"
        class="com.nhnacademy.edu.springframework.messagesender.service.EmailMessageSender">
    </bean>


    <bean
            id="smsMessageSender"
            class="com.nhnacademy.edu.springframework.messagesender.service.SmsMessageSender">
    </bean>

</beans>
```

<br/>

### Bean Scope
- singleton **(default)**
- prototype

<br/>

**Singleton vs Prototype**

Singleton

<img width="661" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-11 á„‹á…©á„’á…® 6 35 19" src="https://user-images.githubusercontent.com/87689191/195054807-72d31e2b-4109-4cb8-b18a-1dedc0cef270.png">

- í•œ ê°œë¡œ ê±”ì† ì‚¬ìš©
- *IoC Containerì—ì„œë§Œ*

Prototype

<img width="648" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-11 á„‹á…©á„’á…® 6 37 31" src="https://user-images.githubusercontent.com/87689191/195055220-d5df9aa4-c80f-425e-91af-32388a3bd962.png">
- ê³„ì† ìƒˆë¡œ ìƒì„±

<br/>

### ì‹¤ìŠµ
ìœ„ xmlíŒŒì¼ì— beanì— `scope=""`ì¶”ê°€
```xml
<bean
    id="emailMessageSender"
    class="com.nhnacademy.edu.springframework.messagesender.service.EmailMessageSender"
    scope="singleton">
</bean>

<bean
    id="smsMessageSender"
    class="com.nhnacademy.edu.springframework.messagesender.service.SmsMessageSender"
    scope="prototype">
</bean>
```

<br/>

### ì´ˆê¸°í™” & ì†Œë©¸
- ì´ˆê¸°í™” : InitializingBean ì¸í„°í˜ì´ìŠ¤ - `afterPropertiesSet()`
- ì†Œë©¸ : DisposableBean ì¸í„°í˜ì´ìŠ¤ - `destroy()`
<br/>

ì´ëŸ° ë°©ë²•ìœ¼ë¡œ êµ¬í˜„ì„ í•˜ë©´ org.springframework.beans.factory.*ì„ ì˜ì¡´ì„ ë°›ì•„ë²„ë ¤ **POJOê°€ ì•„ë‹ˆê²Œ ë˜ì–´ë²„ë¦°ë‹¤.**

<br/>

**í•´ê²°**

```xml
<bean
    id="emailMessageSender"
    class="com.nhnacademy.edu.springframework.messagesender.service.EmailMessageSender"
    scope="singleton"
    init-method="init" destroy-method="destroy">
</bean>

<bean
    id="smsMessageSender"
    class="com.nhnacademy.edu.springframework.messagesender.service.SmsMessageSender"
    scope="prototype"
    init-method="init" destroy-method="destroy">
</bean>
```
- init-method="init" : `init()`ì„ í´ë˜ìŠ¤ì— êµ¬í˜„í•˜ë©´ ë¨
- destroy-method="destroy" : `destroy()`ë¥¼ í´ë˜ìŠ¤ì— êµ¬í˜„í•˜ë©´ ë¨

---

### ì˜ì¡´ì„±(Dependency)
- ì˜ì¡´ê´€ê³„
    - A í´ë˜ìŠ¤ê°€ B í´ë˜ìŠ¤ë¥¼ ì¼ì‹œì ìœ¼ë¡œ ì°¸ì¡°í•˜ëŠ” í˜•íƒœ
- ì—°ê´€ê´€ê³„
    - í´ë˜ìŠ¤ í•„ë“œë¡œ ë‹¤ë¥¸ í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ ê°€ì§€ëŠ” í˜•íƒœ
- ì§‘í•©ê´€ê³„
    - ì—°ê´€ê´€ê³„ì˜ íŠ¹ìˆ˜í•œ í˜•íƒœ
    - A í´ë˜ìŠ¤ì™€ B í´ë˜ìŠ¤ì˜ ìƒëª…ì£¼ê¸°ëŠ” ë°˜ë“œì‹œ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” í˜•íƒœ
- í•©ì„±ê´€ê³„
    - ì—°ê´€ê´€ê³„ì˜ íŠ¹ìˆ˜í•œ í˜•íƒœ
    - ì§‘í•©ê´€ê³„ë³´ë‹¤ ê°•í•œ ê²°í•©
    - A í´ë˜ìŠ¤ì™€ B í´ë˜ìŠ¤ì˜ ìƒëª…ì£¼ê¸°ê°€ ì¼ì¹˜

---
### ì˜ì¡´ì„± ì£¼ì… DI(Dependency Injection)

<br/>

**DI**
- ë””ìì¸ íŒ¨í„´
- ì˜ì¡´ì„± ì´ìŠˆë¡œë¶€í„° í–‰ë™ì„ ë¶„ë¦¬ì‹œí‚¤ëŠ” ê²ƒ
- IoCì˜ êµ¬í˜„

<br/>

### Spring Framework DI
- ìƒì„±ì ì£¼ì…
- ì„¸í„° ì£¼ì…
- í•„ë“œ ì£¼ì…

<br/>

**ìƒì„±ì ì£¼ì… (Constructor Injection)**

MessageSendService í´ë˜ìŠ¤
```java
public class MessageSendService {

    private final MessageSender smsMessageSender;

    public MessageSendService(MessageSender smsMessageSender) {
        this.smsMessageSender = smsMessageSender;
    }
}
```

beans.xml
- `<constructor-arg ref=""/>` ì‚¬ìš©
```xml
<bean
    id="messageSendService"
    class="com.nhnacademy.edu.springframework.messagesender.service.MessageSendService">
    <constructor-arg ref="smsMessageSender" />
</bean>
```

<br/>

**ì„¸í„° ì£¼ì… Setter Injection**

MessageSendService í´ë˜ìŠ¤
- ê¸°ë³¸ ìƒì„±ìê°€ í•„ìš”
```java
public class MessageSendService {

    private MessageSender smsMessageSender;

    public MessageSendService() {
    }

    public void setSmsMessageSender(MessageSender smsMessageSender) {
        System.out.println("Setter ì£¼ì…");
        this.smsMessageSender = smsMessageSender;
    }
}
```

beans.xml
- `<property name="" ref=""/>` ì‚¬ìš©
- name="" : fieldì˜ ë³€ìˆ˜
- ref="" : ì‚¬ìš©í•  Bean ì´ë¦„
```xml
<bean
    id="messageSendService"
    class="com.nhnacademy.edu.springframework.messagesender.service.MessageSendService">
    <constructor-arg ref="smsMessageSender" />
</bean>
```

<br/>

**í•„ë“œ ì£¼ì… Autowired Injection**
- byType
    - typeì˜ Beanì´ **1ê°œ ì—¬ì•¼ë§Œ í•¨**
- byName
    - setterì´ë¦„ì´ Beanì´ë¦„ê³¼ **ë™ì¼ í•´ì•¼í•¨**
    - ex) setKoreanGreeter

beans.xml
```xml
<!-- Autowired ì£¼ì… (byType)  -->
<bean
    id="messageSendService"
    class="com.nhnacademy.edu.springframework.messagesender.service.MessageSendService"
    autowire="byType">
</bean>

<!-- Autowired ì£¼ì… (byName)   -->
<bean
    id="messageSendService"
    class="com.nhnacademy.edu.springframework.messagesender.service.MessageSendService"
    autowire="byName">
</bean>
```


---

### ì‹¤ìŠµ ì½”ë“œ
- [ë§í¬ ğŸ”‘](https://github.com/unhas01/nhnacademy/tree/master/Week7/springframework-core-message-sender)
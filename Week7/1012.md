# 1012 ì •ë¦¬

xmlì—ì„œ annotationê¸°ë°˜ ì„¤ì •ì„ ë°°ìš´ ì‹œê°„

---

### Annotation ê¸°ë°˜ ì„¤ì •
- xmlë°©ì‹ìœ¼ë¡œ Bean ì˜ì¡´ì„± ì£¼ì…ì„ Annotationìœ¼ë¡œ êµ¬í˜„

<br/>

**ì„¤ì •**

beans.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <!-- annotationì„¤ì •ì„ ìœ„í•´ ì¶”ê°€-->
    <context:annotation-config/>
    
</beans>
```

<br/>

### @Required
- ë°˜ë“œì‹œ ì˜ì¡´ì„±ì´ ì£¼ì…ë˜ì–´ì•¼ í•¨ì„ ê°•ì œí•˜ëŠ” Annotation
- Spring ë²„ì „ 5ë¶€í„° ê¶Œì¥í•˜ì§€ ì•ŠëŠ” ì• ë…¸í…Œì´ì…˜

beans.xmlì— ì¶”ê°€
```xml
<!-- @Required ì• ë„ˆí…Œì´ì…˜ ì‚¬ìš©ì„ ìœ„í•´ ì¶”ê°€ -->
<bean class="org.springframework.beans.factory.annotation.RequiredAnnotationBeanPostProcessor" />
```

<br/>

**ì‚¬ìš©**
- ì˜ì¡´ì„± ì£¼ì…ì´ ë°˜ë“œì‹œ ì„±ê³µí•´ì•¼í•˜ í•˜ê¸° ë•Œë¬¸ì— ë³´ì¥ì´ í•„ìš”í•œ setter ë©”ì„œë“œì— ì„¤ì •

<br/>

ì˜ˆì‹œ

```java
public class MessageSendService {
    private MessageSender messageSender;

    @Required
    public void setSmsMessageSender(MessageSender messageSender) {
        this.messageSender = messageSender;
    }
}
```
- beans.xmlì—ì„œ autowire ì†ì„±ì„ ì œê±°í•˜ê³  ì‹¤í–‰í•´ì•¼ í•¨

<br/>

### @Autowired

<Br/>

ì •ì˜ëœ Autowired

```java
@Target({ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Autowired {
    boolean required() default true;
}

```

- @Targetì— ì •ì˜ëœ ìœ„ì¹˜ì— @Autowired ì‚¬ìš© ê°€ëŠ¥

<br/>

**Autowired ì‚¬ìš©ë²•1**
- Setter Injection

```java
public class MessageSendService {
    private MessageSender messageSender;

    @Autowired
    public void setSmsMessageSender(MessageSender messageSender) {
        this.messageSender = messageSender;
    }
}
```

<br/>

**Autowired ì‚¬ìš©ë²•2**
- Field Injection

```java
public class MessageSendService {
    @Autowired
    private MessageSender messageSender;

    public void setSmsMessageSender(MessageSender messageSender) {
        this.messageSender = messageSender;
    }
}
```
<br/>

**Autowired ì‚¬ìš©ë²•3**
- Constructor Injection
- Spring Frameworkì—ì„œ **ê¶Œì¥**í•˜ëŠ” ë°©ì‹
    - Spring 4.3 ë²„ì „ë¶€í„° ìƒì„±ìê°€ 1ê°œì¸ ê²½ìš° ìƒëµ ê°€ëŠ¥

```java
public class MessageSendService {
    
    private final MessageSender messageSender;

    @Autowired
    public MessageSendService(MessageSender messageSender) {
        this.messageSender = messageSender;
    }
}
```

<br/>

**Autowired ì†ì„±**
- required : @Requiredì™€ ë™ì¼í•œ íš¨ê³¼
    - default : true
- primary : ê°™ì€ íƒ€ì…ì˜ ë¹ˆ ì¤‘ ìš°ì„  ì ìš©ì‹œì¼œì£¼ëŠ” ì†ì„±

---

### @Qualifier
- ë¹ˆì˜ ì´ë¦„ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ì£¼ì…
- `@Autowired`ì™€ `@Qualifier`ëŠ” ë‚˜ë€íˆ ë¶™ì—¬ì„œ ì •ì˜í•´ì¤˜ì•¼ ë³´ê¸°ê°€ ì¢‹ìŒ

ì˜ˆì‹œ
```java
public class MessageSendService {
    
    private final MessageSender messageSender;

    @Autowired
    public MessageSendService(@Qualifier("smsMessageSender") MessageSender messageSender) {
        this.messageSender = messageSender;
    }
}
```

<br/>

**ì»¤ìŠ¤í…€ @Qualifier**

ì˜ˆì‹œ
```java
@Target({ElementType.FIELD, ElementType.PARAMETER, ElementType.METHOD, ElementType.CONSTRUCTOR})
@Retention(RetentionPolicy.RUNTIME)
@Qualifier
public @interface SMS {
}
```
- 'ì´ë ‡ê²Œ ì •ì˜ë¥¼ í•  ìˆ˜ ìˆë‹¤'ë¼ê³  ì˜ˆì‹œë¥¼ ë³´ì—¬ì¤€ ì •ë„ê¸° ë•Œë¬¸ì— ì• ë…¸í…Œì´ì…˜ì„ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ë‹¤.
- ëª¨ë“  ì½”ë“œë“¤ì€ ëª©ì ì´ ìˆì–´ì•¼ í•˜ë¯€ë¡œ springì—ì„œ ì œê³µí•˜ëŠ” ì• ë…¸í…Œì´ì…˜ë§Œ ì‚¬ìš©í•´ë„ ì¶©ë¶„í•  ê²ƒì„

```xml
<bean
    id="smsMessageSender"
    class="com.nhnacademy.edu.springframework.messagesender.service.SmsMessageSender"
    init-method="init" destroy-method="destroy">
    <qualifier type="com.nhnacademy.edu.springframework.messagesender.annotation.SMS"/>
</bean>
```
- beans.xmlì— beanì— `qualifier` ì¶”ê°€

---
### @Value
- ì£¼ë¡œ ì™¸ë¶€ ì†ì„±ì„ ì£¼ì…í•˜ê¸° ìœ„í•´ ì‚¬ìš©
    - ex) dbì£¼ì†Œ, ì´ë¦„, ë“±ë“±
- ì™¸ë¶€ì†ì„±ì€ `src/main/resources`ì— `~~~.properties`ì˜ íŒŒì¼ëª…ìœ¼ë¡œ ì„¤ì •

**ì˜ˆì‹œ**

sender.properties

```properties
name=GS
```

beans.xmlì— ì¶”ê°€

```xml
<context:property-placeholder location="classpath:sender.properties" />
```

ì‚¬ìš©
```java
@Value("${name}")
private String name;
```

- beans.xml íŒŒì¼ì— ì†ì„± ì¶”ê°€í•´ì£¼ê³  Javaì—ì„œ @Valueë¡œ ì™¸ë¶€ ì†ì„± ê°’ì„ ì½ìŒ

<br/>

### Annotation ê¸°ë°˜ ì„¤ì •

<br/>

**ì¥ì **
- ì§§ê³  ê°„ê²°í•˜ê²Œ ì„¤ì • ê°€ëŠ¥
- Java ì½”ë“œì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìŒ

<br/>

**ë‹¨ì **
- ì¹¨ìŠµì (invasive) : Annotationì„ ì‚¬ìš©í•˜ë©´ Spring Frameworkì— ì˜ì¡´ì„±ì´ ë°œìƒ
    - ë”ì´ìƒ POJOê°€ ì•„ë‹˜
- ì»´íŒŒì¼ì´ í•„ìš”
    - ìµœê·¼ì—” ì¥ì ì´ì ë‹¨ì (ì»´íŒŒì¼ì´ ì¶©ë¶„íˆ ë¹ ë¦„)
- ì„¤ì •ì´ ë¶„ì‚°ë˜ì–´ì§

---

### Java Configuration

- Javaì–¸ì–´ë¡œ Beanì„ ë§Œë“œëŠ”ê²Œ ê°€ëŠ¥í•´ì§„ ê¸°ëŠ¥

---

### Bean ìƒì„±

<br/>

**ì˜ˆì‹œ**
```java
@Configuration
public class JavaConfig {
    @Bean
    public String dbms() {
        return new String("MYSQL");
    }
}
```
- `@Configuration`ìœ¼ë¡œ Spring Beanì„ ë“±ë¡í•˜ê¸° ìœ„í•œ ì„¤ì •
- `@Bean`ìœ¼ë¡œ Bean ìƒì„±
- ì´ë¦„ì´ "dbms"ì¸ Bean ìƒì„±
    - @Bean(name="example")ì´ëŸ° ì‹ìœ¼ë¡œ ì´ë¦„ì„ ì§€ì •í•´ì£¼ëŠ” ê²ƒ ê°€ëŠ¥

<br/>

### AnnotationConfigApplicationContext

<br/>

**ìƒì„±ì íŒŒë¼ë¯¸í„°**
- `@Configuration` ì„¤ì •í•œ í´ë˜ìŠ¤
- `@Component` ì„¤ì •í•œ í´ë˜ìŠ¤   
    - ìœ„ 2ê°œì˜ ë°©ë²•ì€ ë¦¬íŒ©í† ë§ì´ êµ‰ì¥íˆ ì‰¬ì›Œì§
- File path
    - íŒŒì¼ ìœ„ì¹˜ëŠ” ì–¸ì œë“ ì§€ ë°”ë€” ìˆ˜ê°€ ìˆê¸°ì— ë¦¬íŒ©í† ë§ì´ ì–´ë ¤ì›Œì§ˆ ìˆ˜ ìˆìŒ

<br/>

**xml configuration ê°€ì ¸ì˜¤ëŠ” ë°©ë²•**

```java
@Configuration
@ImportResource("classpath:/beans.xml")
public class MainConfig {
}
```

- `ImportResource` ì‚¬ìš©

<br/>

**Bean LifeCycle**

```java
@Bean(initMethod = "init", destroyMethod = "cleanup")
```

- `init()`êµ¬í˜„ : Bean ìƒì„±ì‹œ ì‹¤í–‰
- `cleanup()` êµ¬í˜„ : Bean ì†Œë©¸ì‹œ ì‹¤í–‰
- `shutdown()` ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ë©´ Springì—ì„œ **ì•”ë¬µì ìœ¼ë¡œ** ì†Œë©¸ì‹œ ì‹¤í–‰ì‹œì¼œì¤Œ

<br/>

**Bean Scope**
```java
@Bean
@Scope("prototype")
```
- default : singleton

<br/>

---

### Bean Dependencies

<br/>

**Case1. ë©”ì„œë“œ í˜¸ì¶œ**
```java
@Configuration
public class JavaConfig {
    @Bean
    @Scope("singleton")
    public ARepository aRepository() {
        return new ARepositoryImpl();
    }

    @Bean
    public AService aService() {
        return new AService(aRepository());
    }
    
    @Bean
    public BService bService() {
        return new ASergice(aRepository());
    }
}
```
- ARepositoryê°€ ë‘ ë²ˆ í˜¸ì¶œ
    - scopeì— ë”°ë¼ Beanì„ ë°˜í™˜

<br/>

**Case2. @Autowired**

```java
@Configuration
public class JavaConfig {
    @Autowired
    private ARepositoryConfig aRepositoryConfig;

    @Bean
    public AService aService() {
        return new AService(aRepositoryConfig.aRepository());
    }
}
```

<br/>

**Case3. ìƒì„±ì ì£¼ì…**

```java
@Configuration
public class JavaConfig {
    @Autowired
    private ARepositoryConfig aRepositoryConfig;

    @Bean
    public AService aService() {
        return new AService(aRepositoryConfig.aRepository());
    }
}
```

<Br/>

**Case4. fully qualifying ì£¼ì…**

```java
@Configuration
public class JavaConfig {
    private final ARepository aRepository;
    
    public JavaConfig(ARepository aRepository) {
        this.aRepository = aRepository;
    }

    @Bean
    public AService aService() {
        return new AService(aRepository);
    }
    
    @Bean
    public BService bService() {
        return new ASergice(aRepository);
    }
}
```

<br/>

ì‚¬ìš©
```java
public class Main {
    
    public static void main(Stirng[] args) {
        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(MainConfig.class, ServiceConfig.class);
    }
}
```
- new AnnotationConfigApplicationContext()ì—ì„œ ì„¤ì •í•œ Config í´ë˜ìŠ¤ë¥¼ ì „ë¶€ ë„£ì–´ì¤˜ì•¼ Spring Beanì´ ìƒì„±ì´ ë¨
- ìƒì„±ì´ëœ ëª¨ë“  Beanì´ contextì— ë“¤ì–´ê°„ë‹¤.
- package pathë¥¼ ë„£ì–´ë„ ëœë‹¤. *(í•´ë‹¹ ê²½ë¡œì˜ ëª¨ë“  íŒŒì¼ì„ ë’¤ì ¸ Beanì„ ë§Œë“¤ê¸° ë–„ë¬¸)*

---

### Component Scan

<br/>

xmlì´ë‚˜ Java Configurationì—ì„œ ëª¨ë“  Beanì„ ì¼ì¼ì´ ë“±ë¡í•´ì•¼ í•˜ë‚˜??    
- Bean Scannigì„ ì´ìš©
    - `Bean Scanning = Component Scanning = Claspath Scanning`

<br/>

**Bean Scanning ëŒ€ìƒ**
- `@Configuration`
- `@Component`
- `@Controller`
- `@Service`
- `@Repository`

<br/>

**@Component ì´ë¦„**
```java
@Service
public class SimpleMovieLister {
}
```
- simpleMovieLister ì´ë¦„ì˜ Bean
- *Springì—ì„œ ì •ì˜ëœ ê·œì¹™*
- `@Service("example")` ì´ëŸ°ì‹ìœ¼ë¡œ ì›í•˜ëŠ” ì´ë¦„ ì„¤ì • ê°€ëŠ¥
    - íŠ¹ë³„í•œ ì¼ì´ ìˆì§€ ì•Šìœ¼ë©´ ê±´ë“œë¦¬ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ìŒ


---

### ì‹¤ìŠµ ì½”ë“œ
- [ë§í¬ ğŸ”‘](https://github.com/unhas01/nhnacademy/tree/master/Week7/springframework-core-message-senderV2)



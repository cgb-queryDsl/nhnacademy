# 1122 ì •ë¦¬

### DB 2ì¼ì°¨

<br/>

**Transaction**
- íŠ¸ëœì­ì…˜ì€ í•˜ë‚˜ì˜ ë…¼ë¦¬ì  ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì‘ì—…ì˜ ë‹¨ìœ„ ë˜ëŠ” ëª¨ë‘ ìˆ˜í–‰ë˜ì–´ì•¼ í•  ì¼ë ¨ì˜ ì—°ì‚°ì„ ì˜ë¯¸

<br/>

**ì†ì„±**
1. Atomicity(ì›ìì„±)
    - íŠ¸ëœì­ì…˜ì˜ ìˆ˜í–‰ê²°ê³¼ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì „ë¶€ ë°˜ì˜ë˜ê±°ë‚˜, ì „ë¶€ ë°˜ì˜ë˜ì§€ ì•Šì•„ì•¼ í•¨(All or Nothing)
    - ì´ë ‡ê²Œ íŠ¸ëœì ì…˜ ì‘ì—… ì¤‘ ë¬¸ì œê°€ ìƒê¸°ë©´ ì „ì²´ ì‘ì—…ì„ ì·¨ì†Œ(ROLLBACK) í•˜ëŠ” ê³¼ì •ì„ ê±°ì³ì•¼ í•¨
1. Consistency(ì¼ê´€ì„±)
    - íŠ¸ëœì­ì…˜ ìˆ˜í–‰ í›„ ë°ì´í„° ëª¨ë¸ì˜ ëª¨ë“  ì œì•½ì¡°ê±´ì„ ë§Œì¡±í•´ì•¼ í•¨
    - í•´ë‹¹ ì»¬ëŸ¼ì´ë‚˜ ë ˆì½”ë“œì— ëª…ì‹œëœ ì œì•½ì¡°ê±´, ê¸°ë³¸ í‚¤ì™€ ì™¸ë˜í‚¤, ì†ì„±ì— ëŒ€í•œ ì œì•½ì¡°ê±´ê³¼ ê°™ì€ ëª…ì‹œì  ë¬´ê²°ì„± ì œì•½ ì¡°ê±´ì„ ë§Œì¡±ì‹œì¼œì•¼ í•¨
1. Isolation(ê³ ë¦½ì„±)
    - íŠ¸ëœì­ì…˜ ìˆ˜í–‰ ì‹œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šì•„ì•¼ í•¨
1. Durability(ì˜ì†ì„±)
    - íŠ¸ëœì­ì…˜ì˜ ì„±ê³µê²°ê³¼ëŠ” ì¥ì•  ë°œìƒ í›„ì—ë„ ë³€í•¨ì—†ì´ ë³´ê´€ë˜ì–´ì•¼ í•¨
    - íŠ¸ëœì­ì…˜ì´ ì‘ì—…ì„ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œí•œ ê²½ìš°ì—ëŠ” ë””ìŠ¤í¬(ë°ì´í„°ë² ì´ìŠ¤)ì— í™•ì‹¤íˆ ê¸°ë¡í•˜ì—¬ì•¼ í•˜ë©°, ë¶€ë¶„ì ìœ¼ë¡œ ìˆ˜í–‰ëœ ê²½ìš°ì—ëŠ” ì‘ì—…ì„ ì·¨ì†Œë˜ì–´ì•¼ í•¨
    - DBMSê°€ ì±…ì„ì§€ê³  ë°ì´í„°ë² ì´ìŠ¤ì— ê¸°ë¡í•˜ëŠ” ì„±ì§ˆì„ íŠ¸ëœì­ì…˜ì˜ Durability(ì˜ì†ì„±)ì´ë¼ í•¨

<Br/>

**Isolation Level**
- READ UNCOMMITTED
    - COMMITê³¼ ROLLBACK ì—¬ë¶€ì— ìƒê´€ ì—†ì´ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ ê°’ì„ ì½ì„ ìˆ˜ ìˆìŒ
    - ë¬¸ì œê°€ ë§ì€ ê²©ë¦¬ ìˆ˜ì¤€ì´ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì„ ì§€ì–‘
    - DIRTY READ í˜„ìƒì´ ë°œìƒ
- READ COMMITTED
    - RDBì—ì„œ ëŒ€ë¶€ë¶„ ê¸°ë³¸ì ìœ¼ë¡œ ì‚¬ìš©ë˜ê³  ìˆëŠ” ê²©ë¦¬ ìˆ˜ì¤€
    - DIRTY READ í˜„ìƒì´ ë°œìƒí•˜ì§€ ì•ŠìŒ
- REPEATABLE READ
    - íŠ¸ëœì­ì…˜ë§ˆë‹¤ íŠ¸ëœì­ì…˜ IDë¥¼ ë¶€ì—¬í•˜ì—¬ IDë³´ë‹¤ ì‘ì€ íŠ¸ëœì­ì…˜ ë²ˆí˜¸ì—ì„œ ë³€ê²½í•œ ê²ƒë§Œ ì½ê²Œ í—ˆìš©
    - UNDO ê³µê°„ì— ë°±ì—…í•´ë‘ê³  ê°’ì„ ë³€ê²½
    - MVCCë¼ ë¶ˆë¦¼
- SERIALIZABLE
    - ê°€ì¥ ë‹¨ìˆœí•œ ê²©ë¦¬ ìˆ˜ì¤€ì´ì§€ë§Œ ê°€ì¥ ì—„ê²©í•œ ìˆ˜ì¤€
    - ì„±ëŠ¥ ì¸¡ë©´ì—ì„œ ë™ì‹œ ì²˜ë¦¬ì„±ëŠ¥ì´ ê°€ì¥ ë‚®ìŒ
    - ì‹¤ë¬´ì—ì„œ ê±°ì˜ ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
- DIRTY READ
    - íŠ¸ëœì­ì…˜ì´ ì‘ì—…ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ëŠ”ë° ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë³¼ ìˆ˜ ìˆê²Œ ë˜ëŠ” í˜„ìƒ
- PHANTOM READ
    - ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ìˆ˜í–‰í•œ ë³€ê²½ ì‘ì—…ì— ì˜í•´ ë ˆì½”ë“œê°€ ë³´ì˜€ë‹¤ê°€ ì•ˆ ë³´ì´ëŠ” í˜„ìƒ

<br/>

**JDBC Transaction**
- ì½”ë“œ
```java
con.setAutoCommit(false);

con.commit();
```

<br/>

**Springì—ì„œ Transaction**
- DatabaseConfigì— Bean ë“±ë¡ì„ í•˜ë©´
- `@Transactional`ì„ ì§€ì›

```java
@Configuration
@EnableTransactionManagement
public class DatabaseConfig {
    @Bean
    public DataSource dataSource() {
        BasicDataSource basicDataSource = new BasicDataSource();
        basicDataSource.setUrl("jdbc:mysql://133.186.211.156:3306/nhn_academy_50");
        basicDataSource.setUsername("nhn_academy_50");
        basicDataSource.setPassword("/B7owD_6TtCRJl6C");
        basicDataSource.setInitialSize(10);
        basicDataSource.setMaxTotal(20);

        return basicDataSource;
    }

    @Bean
    public PlatformTransactionManager transactionManager() {
        return new DataSourceTransactionManager(dataSource());
    }
}
```

<br/>

**@Transactional Propagation**

|ì˜µì…˜|ì„¤ëª…|
|---|---|
|REQUIRED| ê¸°ë³¸ ì˜µì…˜ <br/> ë¶€ëª¨ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•œë‹¤ë©´ ë¶€ëª¨ íŠ¸ëœì­ì…˜ì— í•©ë¥˜, ê·¸ë ‡ì§€ ì•Šë‹¤ë©´ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ë§Œë“ ë‹¤. <br/> ì¤‘ê°„ì— ìì‹/ë¶€ëª¨ì—ì„œ rollbackì´ ë°œìƒëœë‹¤ë©´ ìì‹ê³¼ ë¶€ëª¨ ëª¨ë‘ rollback í•œë‹¤.|
|REQUIRES_NEW | ë¬´ì¡°ê±´ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ë§Œë“ ë‹¤. <br/> nestedí•œ ë°©ì‹ìœ¼ë¡œ ë©”ì†Œë“œ í˜¸ì¶œì´ ì´ë£¨ì–´ì§€ë”ë¼ë„ rollbackì€ ê°ê° ì´ë£¨ì–´ ì§„ë‹¤. |
|MANDATORY|	ë¬´ì¡°ê±´ ë¶€ëª¨ íŠ¸ëœì­ì…˜ì— í•©ë¥˜ì‹œí‚¨ë‹¤. <br/> ë¶€ëª¨ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì˜ˆì™¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.|
|SUPPORTS | ë©”ì†Œë“œê°€ íŠ¸ëœì­ì…˜ì„ í•„ìš”ë¡œ í•˜ì§€ëŠ” ì•Šì§€ë§Œ, ì§„í–‰ ì¤‘ì¸ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ë©´ íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ì§„í–‰ ì¤‘ì¸ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ì§€ ì•Šë”ë¼ë„ ë©”ì†Œë“œëŠ” ì •ìƒì ìœ¼ë¡œ ë™ì‘í•œë‹¤.|
|NESTED| ë¶€ëª¨ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ë©´ ë¶€ëª¨ íŠ¸ëœì­ì…˜ì— ì¤‘ì²©ì‹œí‚¤ê³ , ë¶€ëª¨ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ìƒì„±í•œë‹¤. <br/> ë¶€ëª¨ íŠ¸ëœì­ì…˜ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ìì‹ íŠ¸ëœì­ì…˜ë„ rollbackí•œë‹¤. <br/> ìì‹ íŠ¸ëœì­ì…˜ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ë”ë¼ë„ ë¶€ëª¨ íŠ¸ëœì­ì…˜ì€ rollbackí•˜ì§€ ì•ŠëŠ”ë‹¤. ì´ë•Œ ë¡¤ë°±ì€ ë¶€ëª¨ íŠ¸ëœì­ì…˜ì—ì„œ ìì‹ íŠ¸ëœì­ì…˜ì„ í˜¸ì¶œí•˜ëŠ” ì§€ì ê¹Œì§€ë§Œ ë¡¤ë°±ëœë‹¤. ì´í›„ ë¶€ëª¨ íŠ¸ëœì­ì…˜ì—ì„œ ë¬¸ì œê°€ ì—†ìœ¼ë©´ ë¶€ëª¨ íŠ¸ëœì­ì…˜ì€ ëê¹Œì§€ commit ëœë‹¤. <br/> í˜„ì¬ íŠ¸ëœì­ì…˜ì´ ìˆìœ¼ë©´ ì¤‘ì²© íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ REQUIRED ì²˜ëŸ¼ ë™ì‘í•©ë‹ˆë‹¤.|
|NEVER	| ë©”ì†Œë“œê°€ íŠ¸ëœì­ì…˜ì„ í•„ìš”ë¡œ í•˜ì§€ ì•ŠëŠ”ë‹¤. ë§Œì•½ ì§„í–‰ ì¤‘ì¸ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•˜ë©´ ìµì…‰ì…˜ì´ ë°œìƒí•œë‹¤.|

<br/>

**Alias**
- ë³„ì¹­ì„ ì œê³µí•˜ì—¬ ì ‘ê·¼ì„ ë³„ì¹­ í˜•íƒœë¡œ í•  ìˆ˜ ìˆëŠ” ì—­í• .
- `AS`ë¡œ ì‚¬ìš©
- ì˜ˆì‹œ
```sql
SELECT column_name AS ì´ë¦„
FROM table_name;
```
<br/>

**Pagination**
- ì œê³µí•  ë°ì´í„°ëŠ” ë§ìœ¼ë‚˜, í•œ ë²ˆì— ë‹¤ ë³´ì—¬ì¤„ ìˆ˜ ì—†ì„ ë•Œ ì‚¬ìš©

<br/>

**êµ¬í˜„**
- OFFSET, LIMITì„ ì‚¬ìš©(MySQLì—ì„ )

<br/>

**OFFSET ê³„ì‚°**
- page : í™”ë©´ì— í‘œì‹œë˜ëŠ” Page ë²ˆí˜¸
- pageSize : í˜ì´ì§€ë‹¹ ë³´ì—¬ì§€ëŠ” ë ˆì½”ë“œì˜ ìˆ˜
```
* OFFSET = (page - 1)* pageSize
* LIMIT = pageSize
```

<Br/>

**Pagination page ìˆ˜**
- totalPages : pageì˜ ìˆ˜
- totalCount : ì „ì²´ ë ˆì½”ë“œì˜ ìˆ˜
```
totalPages = (totalCount==0)?1:(int)Math.ceil((double)totalCount/(double)pageSize);
```

<Br/>

**êµ¬í˜„**
- Page.java
```java
public class Page<T> {
    private final List<T> content;
    private final long totalCount;

    public Page(List<T> content, long totalCount) {
        this.content = content;
        this.totalCount = totalCount;
    }

    public List<T> getContent() {
        return content;
    }

    public long getTotalCount() {
        return totalCount;
    }
}
```

<br/>

**Spring Frameworkì—ì„œ JdbcTemplate**
- JdbcTemplate ì—­í• 
    - SQL ì¿¼ë¦¬ ì‹¤í–‰
    - ResultSet ë°˜í™˜ê°’ ì¶”ì¶œ
    - Exception ìºì¹˜

<br/>

**ì‚¬ìš©**
- SELECT ì¿¼ë¦¬
```java
int rowCount = this.jdbcTemplate.queryForObject("select count(*) from Students", Integer.class);
```

- INSERT ì¿¼ë¦¬
```java
this.jdbcTemplate.update(
        "insert into JdbcStudents (id, name, created_at) values (?, ?, ?)",
        1, "Manty", new Timestamp(new Date().getTime()));
```

- UPDATE ì¿¼ë¦¬
```java
this.jdbcTemplate.update(
        "update JdbcStudents set name = ? where id = ?",
        "Dongmyo", 1);
```

- DELETE ì¿¼ë¦¬
```java
this.jdbcTemplate.update(
        "delete from  JdbcStudents where id = ?",
        1);
```

- RowMapper
```java
Student student = jdbcTemplate.queryForObject(
        "select seq, name from JdbcStudents  where id = ?",
        (resultSet, rowNum) -> {
            Student student = new Student();
            student.setSeq(resultSet.getLong("id"));
            student.setName(resultSet.getString("name"));
            return student;
        },
        11);

List<Student> student = jdbcTemplate.query(
        "select id, name from JdbcStudents ",
        (resultSet, rowNum) -> {
            Stduent student = new Stduent();
            student.setSeq(resultSet.getInt("id"));
            student.setName(resultSet.getString("name"));
            return student;
        });
```

<br/>

**ê¶Œì¥í•˜ëŠ” ì‚¬ìš©**
- JdbcTemplateëŠ” ì“°ë ˆë“œì—ì„œ ì•ˆì „
- ì‹±í´í†¤ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ìƒì„±í•´ì„œ ì˜ì¡´ì„± ì£¼ì… ì‚¬ìš©ì„ ê¶Œì¥
```java
private JdbcTemplate jdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.jdbcTemplate = new JdbcTemplate(dataSource);
}
```

<br/>

**NamedParameterJdbcTemplate**
- SQLì—ì„œ ? ëŒ€ì‹  íŒŒë¼ë¯¸í„° ì´ë¦„ ì‚¬ìš© ê°€ëŠ¥ 

<br/>

**SqlParameterSource**
```java
private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}

public int countOfStudentsByName(String name) {
    String sql = "select count(*) from Students where name = :name";
    SqlParameterSource namedParameters = new MapSqlParameterSource("name", name);
    return this.namedParameterJdbcTemplate.queryForObject(sql, namedParameters, Integer.class);
}
```

<br/>

**Map**
- SqlParameterSource ëŒ€ì‹  Map ì„ ì‚¬ìš©
```java
private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}

public int countOfStudentsByName(String name) {
    String sql = "select count(*) from Students where name = :name";
    Map<String, String> namedParameters = Collections.singletonMap("name", name);
    return this.namedParameterJdbcTemplate.queryForObject(sql, namedParameters, Integer.class);
}
```

<br/>

**javaBeans**
```java
public class Student {

    private Integer seq;
    private String firstName;

    public String getFirstName() {
        return this.name;
    }

    public Integer getSeq() {
        return this.seq;
    }

    // setter ìƒëµ
}

private NamedParameterJdbcTemplate namedParameterJdbcTemplate;

public void setDataSource(DataSource dataSource) {
    this.namedParameterJdbcTemplate = new NamedParameterJdbcTemplate(dataSource);
}

public int countOfStudentsByFirstName(Student student) {
    String sql = "select count(*) from Students where name = :firstName";
     SqlParameterSource namedParameters = new BeanPropertySqlParameterSource(student);
    return this.namedParameterJdbcTemplate.queryForObject(sql, namedParameters, Integer.class);
}
```

<br/>

**SQLExceptionTranslator ì¸í„°í˜ì´ìŠ¤**
- SQLErrorCodeSQLExceptionTranslator
    - DBë§ˆë‹¤ ì—ëŸ¬ì½”ë“œê°€ ë‹¤ë¦„
    - ìŠ¤í”„ë§ì€ ì—ëŸ¬ì½”ë“œë¥¼ ì¶”ìƒí™”í•˜ì—¬ ì¼ê´€ì„±ìˆëŠ” ì˜ˆì™¸ë¥¼ ë°˜í™˜ì‹œì¼œì¤Œ

<br/>

**ìë™ ìƒì„±í‚¤ ì¡°íšŒ**
- ìë™ ìƒì„±í‚¤ë¥¼ ì‚¬ìš©í•œ INSERT ë¬¸ì„ ì‚¬ìš©í•˜ë©´ ì´í›„ì— ìƒì„±ëœ í‚¤ë¥¼ ì‚¬ìš©í•  ì¼ì´ ë§ìŒ
- updete()ì™€ keyHolderë¥¼ ì‚¬ìš©í•´ ì¡°íšŒ ê°€ëŠ¥
```java
KeyHolder keyHolder = new GeneratedKeyHolder();
jdbcTemplate.update(connection -> {
    PreparedStatement ps = connection.prepareStatement(INSERT_SQL, new String[] { "seq" });
    ps.setString(1, name);
    return ps;
}, keyHolder);
```

<br/>

**MyBatis**
- ê°œë°œìê°€ ì§€ì •í•œ SQL, ì €ì¥ í”„ë¡œì‹œì €ë¥¼ ì§€ì›í•˜ëŠ” í”„ë ˆì„ì›Œí¬
- ì½”ë“œì™€ íŒŒë¼ë¯¸í„° ì„¤ì • ë° ê²°ê³¼ ë§¤í•‘ì„ ëŒ€ì‹  í•´ì¤Œ

<Br/>

**ì˜ì¡´ì„± ì¶”ê°€**
```xml
<dependency>
  <groupId>org.mybatis</groupId>
  <artifactId>mybatis</artifactId>
  <version>x.x.x</version>
</dependency>
```

**SQL ë§¤í•‘**
- ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì€ XMLì„ í†µí•´ ë§¤í•‘
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nhnacademy.edu.jdbc1.mybatis.StudentMapper">
  <select id="selectStudent" resultType="com.nhnacademy.edu.jdbc1.mybatis.Student">
    select * from Students where id = #{id}
  </select>
</mapper>
```

<br/>

**Annotation ê¸°ë°˜ ë§¤í•‘**
```java
package com.nhnacademy.edu.jdbc1.mybatis;
public interface StudentMapper {
  @Select("SELECT * FROM Students WHERE id = #{id}")
  Student selectStudent(int id);
}
```

**ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ì¤‘ìš”**

<Br/>

**Scopeì™€ ìƒëª…ì£¼ê¸°**
- SqlSessionFactoryBuilder
    - SqlSessionFactoryë¥¼ ìƒì„±í•œ í›„ ìœ ì§€í•  í•„ìš” ì—†ìŒ
    - ê°€ì¥ ì¢‹ì€ ìŠ¤ì½”í”„ëŠ” **ë©”ì†Œë“œ ìŠ¤ì½”í”„**
    - ì¬ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ **ìœ ì§€í•˜ëŠ” ê²ƒì€ ì¢‹ì§€ ì•ŠìŒ**
- SqlSessionFactory
    - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰í•˜ëŠ” ë™ì•ˆ ì¡´ì¬í•´ì•¼ í•¨
    - ì—¬ëŸ¬ ì°¨ë¡€ ë‹¤ì‹œ ë¹Œë“œí•˜ì§€ ì•ŠëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ì€ êµ¬ì„±
    - ê°€ì¥ ì¢‹ì€ ìŠ¤ì½”í”„ëŠ” **ì–´í”Œë¦¬ì¼€ì´ì…˜(ì‹±ê¸€í†¤) ìŠ¤ì½”í”„**
- SqlSession
    - ê° ì“°ë ˆë“œëŠ” ìì²´ì ìœ¼ë¡œ SqlSession ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ì§
    - ê°€ì¥ ì¢‹ì€ ìŠ¤ì½”í”„ëŠ” **ìš”ì²­ ë˜ëŠ” ë©”ì„œë“œ ìŠ¤ì½”í”„**
    - SqlSessionì„ static í•„ë“œë‚˜ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ í•„ë“œë¡œ ì§€ì •í•´ì„  ì•ˆë¨
- Mapper ì¸ìŠ¤í„´ìŠ¤
    - ê°€ì¥ ì¢‹ì€ ìŠ¤ì½”í”„ëŠ” SqlSessionê³¼ ë™ì¼

<br/>

**Mapper TypeAliases**
- XML ì„¤ì •ì—ì„œë§Œ ì‚¬ìš©
- íƒ€ì´í•‘ì„ ì¤„ì´ê¸° ìœ„í•¨
```xml
<typeAliases>
  <typeAlias alias="Student" type="com.nhnacademy.edu.jdbc1.mybatis.Student"/>
  <typeAlias alias="Teacher" type="com.nhnacademy.edu.jdbc1.mybatis.Teacher"/>
</typeAliases>
```
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nhnacademy.edu.jdbc1.mybatis.StudentMapper">
  <select id="selectStudent" resultType="Student">
    select * from Students where id = #{id}
  </select>
</mapper>
```

<br/>

**Mapper ì‚¬ìš©**
- select
```xml
<select id="selectStudent" parameterType="int" resultType="hashmap">
  SELECT * FROM Students WHERE id = #{id}
</select>
```
- update
```xml
<update id="updateAuthor">
  update Author set
    username = #{username},
    password = #{password},
    email = #{email},
    bio = #{bio}
  where id = #{id}
</update>
```
- delete
```xml
<delete id="deleteAuthor">
  delete from Author where id = #{id}
</delete>
```
- insert
```xml
<insert id="insertStudent" >
  insert into Students (name,score,created_at)
  values (#{name},#{score},#{createdAt})
</insert>
```

<br/>

**Spring Frameworkì—ì„œ MyBatis**
- ì˜ì¡´ì„± ì¶”ê°€
```xml
<dependency>
  <groupId>org.mybatis</groupId>
  <artifactId>mybatis</artifactId>
  <version>x.x.x</version>
</dependency>

<dependency>
  <groupId>org.mybatis</groupId>
  <artifactId>mybatis-spring</artifactId>
  <version>2.0.7</version>
</dependency>
```

<Br/>

**ì„¤ì •**
- ìŠ¤í”„ë§ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…ìŠ¤íŠ¸ì— SqlSessionFactoryì™€ í•œ ê°œ ì´ìƒì˜ ë§¤í¼ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì„¤ì •í•´ì•¼ í•¨
- SqlSessionFactoryBeanê°€ SqlSessionFactoryBuilderë¥¼ ëŒ€ì‹ 
```java
@Configuration
public class MyBatisConfig {

  @Bean
  public SqlSessionFactory sqlSessionFactory(DataSource dataSource) throws Exception {
    SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();
    factoryBean.setDataSource(dataSource);
    
    // Mapper ë“±ë¡
    PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
    bean.setMapperLocations(resolver.getResources("classpath:com/nhnacademy/edu/**/*Mapper.xml"));
        
    return factoryBean.getObject();
  }
}
```

- ê³¼ì œì—ì„œ ì‚¬ìš©í•œ ì„¤ì •
```java
@Bean
public DataSource logDataSource(){
    return new P6DataSource(dataSource());
}

@Bean
public SqlSessionFactoryBean sqlSessionFactoryBean() throws IOException {
    PathMatchingResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
    SqlSessionFactoryBean sessionFactory = new SqlSessionFactoryBean();
    sessionFactory.setDataSource(logDataSource());
    sessionFactory.setMapperLocations(resolver.getResources("classpath*:**/maps/*.xml"));
    return sessionFactory;
}
```

<Br/>

**SqlSession**
- SqlSessionì„ ìƒì„±í•˜ê¸° ìœ„í•´ SqlSessionFactoryë¥¼ ì‚¬ìš©
- ì„¸ì…˜ì„ í•œ ë²ˆ ìƒì„±í•˜ë©´ ì»¤ë°‹ ë˜ëŠ” ë¡¤ë°±ì„ í•˜ê¸° ìœ„í•´ ì„¸ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ. ë” í•„ìš”í•˜ì§€ ì•Šìœ¼ë©´ ë‹«ì•„ì£¼ì–´ì•¼ í•¨
- MyBatis Springì„ ì‚¬ìš©í•˜ë©´ SqlSessionFactoryë¥¼ ì§ì ‘ ì‚¬ìš©í•  í•„ìš” ì—†ìŒ
- ìŠ¤í”„ë§ íŠ¸ëœì­ì…˜ ì„¤ì •ì— ë”°ë¼ ì•ˆì „í•œ SqlSession ê°ì²´ê°€ Beanì— ì£¼ì…

<Br/>

**Transaction**
- ë§ˆì´ë°”í‹°ìŠ¤ ìŠ¤í”„ë§ ì—°ë™ëª¨ë“ˆì„ ì‚¬ìš©í•˜ë©´ ìŠ¤í”„ë§ íŠ¸ëœì ì…˜ê³¼ ì—°ë™
- ë§ˆì´ë°”í‹°ìŠ¤ì— ì¢…ì†ë˜ëŠ” ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ ê´€ë¦¬ë¥¼ ë§Œë“œëŠ” ê²ƒë³´ë‹¤ëŠ” ë§ˆì´ë°”í‹°ìŠ¤ ìŠ¤í”„ë§ ì—°ë™ëª¨ë“ˆì´ ìŠ¤í”„ë§ì˜ DataSourceTransactionManagerê³¼ ìœµí•©ë˜ëŠ” ê²ƒì„ ê¶Œì¥
- íŠ¸ëœì­ì…˜ì´ ë™ì‘í•˜ëŠ” ë™ì•ˆ, í•˜ë‚˜ì˜ SqlSessionê°ì²´ê°€ ìƒì„±ë˜ê³  ì§€ì†ì ìœ¼ë¡œ ì‚¬ìš©, ì„¸ì…˜ì€ íŠ¸ëœì­ì…˜ì´ ì™„ë£Œë˜ë©´ ì ì ˆíˆ ì»¤ë°‹ì´ ë˜ê±°ë‚˜ ë¡¤ë°±

**MapperScan**
- MapperScan ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë©´ ê°ê°ì˜ ë§¤í¼ë¥¼ í•˜ë‚˜ í•˜ë‚˜ ìŠ¤í”„ë§ë¹ˆìœ¼ë¡œ ì„¤ì •í•  í•„ìš”ê°€ ì—†ìŒ
- MapperScanì„¤ì • ë°©ë²•
```java
@MapperScan(basePakcages = "com.nhnacademy.edu.jdbc1.domain",annotationClass = Mapper.class)
```

---

### ê³¼ì œ

1. Connection Pool ì‚¬ìš©
1. Login
    - ì‚¬ìš©ì ID, Passwordë¥¼ ì…ë ¥í•˜ì—¬ DBí…Œì´ë¸”ì— ìˆëŠ” ìœ ì €ê°€ ìˆë‹¤ë©´ ë¡œê·¸ì¸ 
    - SQL Injection ê³µê²©ì„ ë§‰ëŠ” ì½”ë“œë¡œ ì‘ì„±
    - ë¦¬ì†ŒìŠ¤ ëˆ„ìˆ˜ ì£¼ì˜
1. ê°•ì˜ ê´€ë¦¬
    - ê°•ì˜ ëª©ë¡ì„ ì¡°íšŒí•˜ë©´ ê°•ì˜ë¥¼ í™”ë©´ì— ë·°
    - ê°•ì˜ ë“±ë¡ì„ í•˜ë©´ ì •ë³´ë¥¼ ì…ë ¥í•  í™”ë©´ì„ ë³´ì—¬ì£¼ê³  ë“±ë¡ì‹œ DBì—ë„ ì €ì¥
    - ì‚­ì œë¥¼ í•˜ë©´ ê°•ì˜ê°€ ì‚­ì œ, DBì—ì„œë„ ì‚­ì œ
    - ìˆ˜ì •ì„ í•˜ë©´ ì •ë³´ë¥¼ ì…ë ¥í•  í™”ë©´ì„ ë³´ì—¬ì£¼ê³  ìˆ˜ì •ì‹œ DBì—ë„ ë³€ê²½ ë‚´ìš©ì„ ì €ì¥

<Br/>

**ì½”ë“œ**
- [ë§í¬ ğŸ”‘](https://github.com/unhas01/nhnacademy/tree/master/Week13/jdbc_workshop1)




